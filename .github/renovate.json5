{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",

  // Renovate defaults + safety
  extends: ["config:best-practices"],

  timezone: "Etc/UTC",
  schedule: ["before 3am on saturday"],

  // Managers allowed on GitHub-hosted Renovate
  enabledManagers: ["regex", "nix", "github-actions"],

  nix: {
    enabled: true,
    fileMatch: ["flake\\.nix$", "flake\\.lock$", "\\.nix$"],
  },

  // regex manager to capture all Docker images
  regexManagers: [
    {
      fileMatch: ["\\.nix$"],
      matchStrings: [
        // image = "repo/name:tag"
        'image\\s*=\\s*"(?<depName>[^:"]+):(?<currentValue>[^"]+)"',
      ],
      datasourceTemplate: "docker",
      // tell renovate “do not try semver — treat tags as strings”
      extractVersionTemplate: "^.*$",
    },
  ],

  // Allow Renovate to update even non-semver or weird tags
  packageRules: [
    {
      matchDatasources: ["docker"],
      looseVersioning: true,
      commitMessageTopic: "Docker image",
    },
  ],
}
