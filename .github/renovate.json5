{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",

  extends: ["config:best-practices"],

  timezone: "Etc/UTC",
  schedule: ["before 3am on saturday"],

  enabledManagers: ["nix", "regex", "github-actions", "custom"],

  nix: {
    enabled: true,
    fileMatch: ["flake\\.nix$", "flake\\.lock$", "\\.nix$"],
  },

  /*
   * -----------------------------------------
   *  CUSTOM MANAGER FOR DOCKER IN NIX FILES
   * -----------------------------------------
   */
  customManagers: [
    {
      customType: "regex",
      fileMatch: ["\\.nix$"],

      // Capture any image = "<repo>:<tag>"
      matchStrings: [
        'image\\s*=\\s*"(?<depName>[^:]+):(?<currentValue>[^"]+)"',
      ],

      datasourceTemplate: "docker",

      // apply custom versioning to all SDR-Enthusiasts images
      versioningTemplate: "loose",

      // Add ALL SDR-E repos here
      matchDepNames: [
        "ghcr.io/sdr-enthusiasts/docker-acarsdec",
        "ghcr.io/sdr-enthusiasts/docker-adsb-ultrafeeder",
        "ghcr.io/sdr-enthusiasts/docker-adsbhub",
        "ghcr.io/sdr-enthusiasts/docker-airnavradar",
        "ghcr.io/sdr-enthusiasts/docker-sdrmap",
        "ghcr.io/sdr-enthusiasts/airspy_adsb",
        "ghcr.io/sdr-enthusiasts/acars_router",
        "ghcr.io/sdr-enthusiasts/docker-dump978",
        "ghcr.io/sdr-enthusiasts/docker-dumphfdl",
        "ghcr.io/sdr-enthusiasts/docker-dumpvdl2",
        "ghcr.io/sdr-enthusiasts/docker-flightradar24",
        "ghcr.io/sdr-enthusiasts/docker-piaware",
        "ghcr.io/sdr-enthusiasts/docker-planefinder",
        "ghcr.io/sdr-enthusiasts/docker-radarvirtuel",
        "ghcr.io/plane-watch/docker-plane-watch",
      ],
    },
  ],

  // normal regex manager still allowed for other docker images
  regexManagers: [
    {
      fileMatch: ["\\.nix$"],
      matchStrings: [
        'image\\s*=\\s*"(?<depName>[^:]+):(?<currentValue>[^"]+)"',
      ],
      datasourceTemplate: "docker",
    },
  ],

  packageRules: [
    {
      matchDatasources: ["docker"],
      commitMessageTopic: "Docker image",
    },
  ],
}
