{
  $schema: "https://docs.renovatebot.com/renovate-schema.json",

  extends: ["config:best-practices"],

  timezone: "Etc/UTC",
  schedule: ["before 3am on saturday"],

  enabledManagers: ["nix", "regex", "github-actions"],

  nix: {
    enabled: true,
    fileMatch: ["flake\\.nix$", "flake\\.lock$", "\\.nix$"],
  },

  regexManagers: [
    {
      fileMatch: ["\\.nix$"],

      // Match: image = "ghcr.io/sdr-enthusiasts/docker-dumpvdl2:trixie-latest-build-123"
      matchStrings: [
        'image\\s*=\\s*"(?<depName>[^:"]+):(?<currentValue>[^"\\s]+)"',
      ],

      // Normalize ANY docker tag ending in "-123" â†’ version "123"
      // Works with: latest-build-818, trixie-latest-build-10, etc.
      versioningTemplate: "regex",
      extractVersionTemplate: ".*-(?<version>\\d+)$",

      datasourceTemplate: "docker",
    },
  ],

  packageRules: [
    {
      matchDatasources: ["docker"],
      commitMessageTopic: "Docker image",
    },
  ],
}
